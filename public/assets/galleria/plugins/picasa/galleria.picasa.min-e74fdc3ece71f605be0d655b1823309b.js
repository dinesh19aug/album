/*
 Galleria Picasa Plugin 2011-08-01
 http://galleria.aino.se

 Copyright 2011, Aino
 Licensed under the MIT license.
*/
Galleria.requires(1.25,"The Picasa Plugin requires Galleria version 1.2.5 or later."),function(a){var b=Galleria.utils.getScriptPath();Galleria.Picasa=function(){this.options={max:30,imageSize:"medium",thumbSize:"thumb",description:!1,complete:function(){}}},Galleria.Picasa.prototype={constructor:Galleria.Picasa,search:function(a,b){return this._call("search","all",{q:a},b)},user:function(a,b){return this._call("user","user/"+a,b)},useralbum:function(a,b,c){return this._call("useralbum","user/"+a+"/album/"+b,c)},setOptions:function(b){return a.extend(this.options,b),this},_call:function(b,c,d,e){c="https://picasaweb.google.com/data/feed/api/"+c+"?",typeof d=="function"&&(e=d,d={});var g=this,d=a.extend({kind:"photo",access:"public","max-results":this.options.max,thumbsize:this._getSizes().join(","),alt:"json-in-script",callback:"?"},d);a.each(d,function(a,b){c+="&"+a+"="+b});var h=!1;return Galleria.utils.wait({until:function(){return h},success:function(){g._parse.call(g,h.feed.entry,e)},error:function(){var a="";b=="user"?a="user not found.":b=="useralbum"&&(a="album or user not found."),Galleria.raise("Picasa request failed"+(a?": "+a:"."))},timeout:5e3}),a.getJSON(c,function(a){h=a}),g},_getSizes:function(){var b={small:"72c",thumb:"104u",medium:"640u",big:"1024u",original:"1600u"},c=this.options,d={},e,g=[32,48,64,72,94,104,110,128,144,150,160,200,220,288,320,400,512,576,640,720,800,912,1024,1152,1280,1440,1600];return a(["thumbSize","imageSize"]).each(function(){c[this]in b?d[this]=b[c[this]]:(e=Galleria.utils.parseValue(c[this]),e>1600?e=1600:a.each(g,function(a){if(e<this)return e=g[a-1],!1}),d[this]=e)}),[d.thumbSize,d.imageSize,"1280u"]},_parse:function(b,c){var d=this,e=[],g;a.each(b,function(){g=this.media$group.media$thumbnail,e.push({thumb:g[0].url,image:g[1].url,big:g[2].url,title:this.title.$t,description:d.options.description?this.summary.$t:""})}),c.call(this,e)}};var c=Galleria.prototype.load;Galleria.prototype.load=function(){if(arguments.length||typeof this._options.picasa!="string")c.apply(this,Galleria.utils.array(arguments));else{var d=this,e=Galleria.utils.array(arguments),g=this._options.picasa.split(":"),j,k=a.extend({},d._options.picasaOptions),l=typeof k.loader!="undefined"?k.loader:a("<div>").css({width:48,height:48,opacity:.7,background:"#000 url("+b+"loader.gif) no-repeat 50% 50%"});if(g.length){if(typeof Galleria.Picasa.prototype[g[0]]!="function")return Galleria.raise(g[0]+" method not found in Picasa plugin"),c.apply(this,e);if(!g[1])return Galleria.raise("No picasa argument found"),c.apply(this,e);window.setTimeout(function(){d.$("target").append(l)},100),j=new Galleria.Picasa,typeof d._options.picasaOptions=="object"&&j.setOptions(d._options.picasaOptions),e=[];if(g[0]=="useralbum"){if(e=g[1].split("/"),e.length!=2){Galleria.raise("Picasa useralbum not correctly formatted (should be [user]/[album])");return}}else e.push(g[1]);e.push(function(a){d._data=a,l.remove(),d.trigger(Galleria.DATA),j.options.complete.call(j,a)}),j[g[0]].apply(j,e)}else c.apply(this,e)}}}(jQuery)